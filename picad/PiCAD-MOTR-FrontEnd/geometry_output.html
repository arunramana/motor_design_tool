<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport" />
       <meta name="description" content="PI Labs" />
    <meta name="author" content="Labs" />
    <title>PI Labs</title>

   <link href="assets/css/fonts/font-awesome.css" rel="stylesheet" type="text/css" />
   	<link href="assets/css/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
	<link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/style.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/responsive.css" rel="stylesheet" type="text/css" />	
	
    <link rel="shortcut icon" href="assets/images/favicon.png" /> 

 </head>
<body class="page-header-fixed sidemenu-closed-hidelogo page-content-white page-md header-white dark-sidebar-color logo-dark">
    <div class="page-wrapper">
        <div class="page-header navbar navbar-fixed-top" elementsection="header">
            <div class="page-header-inner ">
                <div class="page-logo">
                    <a href="motor_wiz_inputs.html"><img src="assets/images/logo.svg" alt="ChatBot"> </a>
                </div>				
                
                <a href="javascript:;" class="menu-toggler responsive-toggler" data-toggle="collapse" data-target=".navbar-collapse">
                    <span></span>
                </a>
					<div class="pull-left"><div class="bred_hd"><i class="back_ic" onClick="window.location.href='motor_wiz_inputs.html'"></i> <span id="vehiName"></span> / <span id="motoName"></span>/ Output</div></div>
                <div class="top-menu">
                    <ul class="nav navbar-nav pull-right">
                       
 						<li class="dropdown dropdown-user">
                            <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                                <span class="avatar" id="avatar"></span>
                                <span class="hd_txt">
                                    <span id="userName"></span><br>
                                    <span class="username username-hide-on-mobile" id="userMail"></span>
                                </span>
                            </a>
							
                            <ul class="dropdown-menu dropdown-menu-default animated jello">
                                <!-- <li>
                                     <a href="profile.html"> <i class="change_pass_ic"></i> Change Password </a>
                                </li> -->							
								<li>
                                    <a href="javascript:void(0);" onclick="logout()"> <i class="logout_ic"></i><label>Log out</label> </a>
                               </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div> 
        </div>
			 
        <div class="page-container">
		<div class="sidebar-container"  elementsection="menu"> 
 				<div class="sidemenu-container navbar-collapse collapse fixed-menu pad15T">
	                <div id="remove-scroll">
	                    <ul class="sidemenu page-header-fixed p-t-20" data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200">	                  
                            <li class="nav-item">
	                            <a class="nav-link nav-toggle">
                                    <i class="dashboard_ic"></i> </a>
							</li>
                            <li class="nav-item">
	                            <a class="nav-link nav-toggle"> 
                                    <i class="vehicle_dynamics"></i></a>
							</li>
							  <li class="nav-item active">
	                            <a class="nav-link nav-toggle"> 
                                    <i class="motor_wiz_inputs"></i> </a>
							</li>                            
	                    </ul>
	                </div>
                </div>
            </div>
			
		<div class="page-content-wrapper">
			<div class="page-content">			   							 
			<div class="row d-flex align-items-center dash_pad1">   
					<div class="col-md-12 pad25T">								
						
						<div id="process" class="w80p">
            <ul id="stepButtons" class="process-row nav nav-tabs">                
                <li class="process-step active">
                    <button type="button" class="btn btn-circle btn-default" data-toggle="tab" onClick="window.location.href='geometry_output.html'">
                        <i class="geometry_ic"></i>
                    </button>
                    <p>Geometry</p>
                </li>                
                <li class="process-step">
                    <button type="button" class="btn btn-circle btn-default" data-toggle="tab" onClick="window.location.href='winding_output.html'">
					 <i class="wiring_ic"></i>
					</button>
                    <p>Winding Diagram</p>
                </li>
				<li class="process-step">
                    <button type="button" class="btn btn-circle btn-default" data-toggle="tab" onClick="window.location.href='flux_density_output.html'">
					 <i class="flux_ic"></i>
					</button>
                    <p>Flux Density Plot</p>
                </li>
                <li class="process-step">
                    <button type="button" class="btn btn-circle btn-default" data-toggle="tab" onClick="window.location.href='air_gap_output.html'">
					 <i class="air_gap"></i>
					</button>
                    <p>Air Gap Flux</p>
                </li>
                <li class="process-step">
                    <button type="button" class="btn btn-circle btn-default" data-toggle="tab" onClick="window.location.href='performance_output.html'">
					 <i class="performance"></i>
					</button>
                    <p>Performance Analysis</p>
                </li>
                <li class="process-step">
                    <button type="button" class="btn btn-circle btn-default" data-toggle="tab" onClick="window.location.href='cost_output.html'">
					 <i class="cost_ic"></i>
					</button>
                    <p>Cost & Weight</p>
                </li>
                
            </ul>
        </div>
					<div class="clear mrg25B"></div>						
					<div class="row d-flex align-items-center dash_pad">   
													
									<div class="col-md-6 mrg20B pad20R"><div class="table_grid1">
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
		  <tr>
			<th>Parameter</th>
			<th align="center">Value</th>
		  </tr>
		  <tr>
			<td>Rotor OD</td>
			<td id="rotor_od"></td>
		  </tr>
		  <tr>
			<td>Tooth Thickness</td>
			<td id="tooth_thickness">19</td>
		  </tr>
		  <tr>
			<td>Slot OD</td>
			<td id="slot_od">167</td>
		  </tr>
		  <tr>
			<td>Slot Depth</td>
			<td id="slot_depth">22</td>
		  </tr>
		  <tr>
		    <td>Yoke Thickness</td>
		    <td id="yoke_thickness">11</td>
  </tr>
		  <tr>
		    <td>Stator OD</td>
		    <td id="stator_od">190</td>
  </tr>
		  <tr>
		    <td>Shaft Diameter</td>
		    <td id="shaft_dia">100</td>
  </tr>
		  <tr>
		    <td>Mean Slot Dia</td>
		    <td id="mean_slot_dia">145</td>
  </tr>
		  <tr>
		    <td>Stack Length</td>
		    <td id="stack_length">53</td>
  </tr>
		  
		</table>
		
									</div></div>
										
									<div class="col-md-6 mrg20B pad20L" align="center">	
										<img src="" class="w-100p" id="geometry_image">
									</div>
									
								</div>
								
							<div class="clear mrg25B"></div>
				<div class="row">
						<div class="col-sm-4" align="left"><button class="nxt_pre_btns" onClick="window.location.href='motor_wiz_inputs.html'" ><img src="assets/images/arrow_left.svg"> Previous</button></div>
						<div class="col-sm-4" align="center"><button class="nxt_pre_btns" id="downloadBtn">Download <img src="assets/images/download_ic1.svg" align="absmiddle"> </button></div>
						<div class="col-sm-4" align="right"><button class="nxt_pre_btns" onClick="window.location.href='winding_output.html'">Next <img src="assets/images/arrow_right.svg"> </button></div>
					
				</div>
				
				</div>				
			</div>	
		
						
						
						
					  </div>
					<div class="clear mrg15B"></div>
					
			</div>	
								
		 </div>		
		 
        </div>
		</div>
	</div>
    </div>
	


</div>
<div class="loader_animation_overlay" id="loader_animation_overlay">
    <div class="loader_animation" id="loader_animation"></div>
</div>
	
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/bootstrap4.min.js" ></script>
	<script src="./assets/js/config.js"></script>
<script>

document.getElementById("userMail").innerText = userMail;
document.getElementById("userName").innerText = userName;
document.getElementById("avatar").innerText = userName.charAt(0).toUpperCase();

function showLoader() {
    document.getElementById('loader_animation_overlay').style.display = 'flex';
}

function hideLoader() {
    document.getElementById('loader_animation_overlay').style.display = 'none';
}


function getQueryParams(param) {
        var urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }
	let vehiName = getQueryParams("vehicle_name");
    if(!vehiName){
        vehiName = localStorage.getItem("vehicle_name")
        document.getElementById("vehiName").innerText = vehiName;
    }else{
        document.getElementById("vehiName").innerText = vehiName;
        localStorage.setItem("vehicle_name", vehiName); // Store in local storage
    }

	
let motoName = getQueryParams("motor_name");
    if(!motoName){
        motoName = localStorage.getItem("motor_name")
        document.getElementById("motoName").innerText = motoName;
    }else{
        document.getElementById("motoName").innerText = motoName;
        localStorage.setItem("motor_name", motoName); // Store in local storage
    }
	function isEmpty(obj) {
    for(var key in obj) {
        if(obj.hasOwnProperty(key))
            return false;
    }
    return true;
}
console.log("motorName",motoName)

document.addEventListener("DOMContentLoaded", function() {
fetchMotorData()
});



function fetchMotorData() {
    showLoader()
    const storedData = localStorage.getItem('motorDataOutput');
    
    if (storedData && !isEmpty(storedData)) {
        hideLoader()
        const motorDataOutput = JSON.parse(storedData);
                console.log("int",motorDataOutput);
                geometry_graph(motorDataOutput)
            } else {
                hideLoader()
                console.log("No data available. User needs to input values.");
            }
            
      }

function geometry_graph(data){
    console.log("data",data)
    var geometry_image=data.dxf
    const geo_img = document.getElementById('geometry_image');
    //Geometry_Image:
    geo_img.src = 'data:image/png;base64,' + geometry_image;
    geo_img.style.width='80%';
    geo_img.style.height='80%';

    document.getElementById('rotor_od').textContent=Math.round(data.geometry.rotor_od)
    document.getElementById('tooth_thickness').textContent=Math.round(data.geometry.tooth_thickness)
    document.getElementById('slot_od').textContent=Math.round(data.geometry.slot_od)
    document.getElementById('slot_depth').textContent=Math.round(data.geometry.slot_depth)
    document.getElementById('yoke_thickness').textContent=Math.round(data.geometry.yoke_thickness)
    document.getElementById('shaft_dia').textContent=Math.round(data.geometry.shaft_dia)
    document.getElementById('stator_od').textContent=Math.round(data.geometry.stator_od)
    document.getElementById('mean_slot_dia').textContent=Math.round(data.geometry.mean_slot_dia)
    document.getElementById('stack_length').textContent=Math.round(data.geometry.stack_length) 
}

$(document).ready(function() {
 // executes when HTML-Document is loaded and DOM is ready
console.log("document is ready");
  
  
// document ready  
});


function logout() {
            sessionStorage.removeItem('user_id');
            window.location.href = 'login.html';
        }


window.onload = function() {
            // Check if user_id is present in sessionStorage
            const userId = sessionStorage.getItem('user_id');
            if (!userId) {
                // If user_id is present, redirect to dashboard.html
                // If user_id is not present, redirect to login.html
                window.location.href = "login.html";
            }
};

document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("downloadBtn").addEventListener("click", function() {
                showLoader()
                const myHeaders = new Headers();
                myHeaders.append("Content-Type", "application/json");

                const raw = JSON.stringify({
                    "user_id": user_id,
                    "vehicle_name": vehiName,
                    "motor_name": motoName
                });

                const requestOptions = {
                    method: "POST",
                    headers: myHeaders,
                    body: raw,
                    redirect: "follow"
                };

                fetch(base_url+"/download", requestOptions)
                    .then(response => {
                        if (!response.ok) { 
                            throw new Error('Network response was not ok');
                        }
                        hideLoader()
                        return response.blob();
                    })
                    .then(blob => {
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.style.display = 'none';
                        a.href = url;
                        a.download = vehiName+'_'+motoName+'.zip'; // Set the file name here
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                    })
                    .catch(error => {
                        hideLoader()
                        console.error('There was an error!', error)});
            });

        });

</script>
  </body>
</html>